<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Two-stage predictor substitution (TSPS) estimators — tsps • OneSampleMR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Two-stage predictor substitution (TSPS) estimators — tsps" />
<meta property="og:description" content="Terza et al. (2008) give an excellent description of TSPS estimators.
They proceed by fitting a first stage model of the
exposure regressed upon the instruments (and possibly any measured
confounders). From this the predicted values of the exposure are obtained.
A second stage model is then fitted of the outcome regressed upon
the predicted values of the exposure (and possibly measured confounders)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">OneSampleMR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/compare-smm-fits.html">Comparison fits of the multiplicative structural mean model</a>
    </li>
    <li>
      <a href="../articles/f-statistic-comparison.html">Comparison of conditional F-statistics</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/remlapmot/OneSampleMR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Two-stage predictor substitution (TSPS) estimators</h1>
    <small class="dont-index">Source: <a href='https://github.com/remlapmot/OneSampleMR/blob/master/R/tsps.R'><code>R/tsps.R</code></a></small>
    <div class="hidden name"><code>tsps.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Terza et al. (2008) give an excellent description of TSPS estimators.
They proceed by fitting a first stage model of the
exposure regressed upon the instruments (and possibly any measured
confounders). From this the predicted values of the exposure are obtained.
A second stage model is then fitted of the outcome regressed upon
the predicted values of the exposure (and possibly measured confounders).</p>
    </div>

    <pre class="usage"><span class='fu'>tsps</span><span class='op'>(</span>
  <span class='va'>formula</span>,
  <span class='va'>instruments</span>,
  <span class='va'>data</span>,
  <span class='va'>subset</span>,
  <span class='va'>na.action</span>,
  contrasts <span class='op'>=</span> <span class='cn'>NULL</span>,
  t0 <span class='op'>=</span> <span class='cn'>NULL</span>,
  link <span class='op'>=</span> <span class='st'>"identity"</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula</th>
      <td><p>formula specification(s) of the regression
relationship and the instruments. Either <code>instruments</code> is missing and
<code>formula</code> has three parts as in <code>y ~ x1 + x2 | z1 + z2 + z3</code>
(recommended) or <code>formula</code> is <code>y ~ x1 + x2</code> and <code>instruments</code>
is a one-sided formula <code>~ z1 + z2 + z3</code> (only for backward
compatibility).</p></td>
    </tr>
    <tr>
      <th>instruments</th>
      <td><p>formula specification(s) of the regression
relationship and the instruments. Either <code>instruments</code> is missing and
<code>formula</code> has three parts as in <code>y ~ x1 + x2 | z1 + z2 + z3</code>
(recommended) or <code>formula</code> is <code>y ~ x1 + x2</code> and <code>instruments</code>
is a one-sided formula <code>~ z1 + z2 + z3</code> (only for backward
compatibility).</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>an optional data frame containing the variables in the model.
By default the variables are taken from the environment of the
<code>formula</code>.</p></td>
    </tr>
    <tr>
      <th>subset</th>
      <td><p>an optional vector specifying a subset of observations to be
used in fitting the model.</p></td>
    </tr>
    <tr>
      <th>na.action</th>
      <td><p>a function that indicates what should happen when the data
contain <code>NA</code>s. The default is set by the <code>na.action</code> option.</p></td>
    </tr>
    <tr>
      <th>contrasts</th>
      <td><p>an optional list. See the <code>contrasts.arg</code> of
<code><a href='https://rdrr.io/r/stats/model.matrix.html'>model.matrix.default</a></code>.</p></td>
    </tr>
    <tr>
      <th>t0</th>
      <td><p>A vector of starting values for the gmm optimizer. This should
have length equal to the number of exposures plus 1.</p></td>
    </tr>
    <tr>
      <th>link</th>
      <td><p>character; one of <code>"identity"</code> (the default), <code>"logadd"</code>, <code>"logmult"</code>, <code>"logit"</code>.
This is the link function for the second stage model. <code>"identity"</code> corresponds to linear
regression; <code>"logadd"</code> is log-additive and corresponds to Poisson / log-binomial regression;
<code>"logmult"</code> is log-multiplicative and corresponds to gamma regression;
<code>"logit"</code> corresponds to logistic regression.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>further arguments passed to or from other methods.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>tsps()</code> performs GMM estimation to ensure appropriate standard errors
on its estimates similar to the approach described in Clarke et al. (2015).</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Burgess S, CRP CHD Genetics Collaboration.
Identifying the odds ratio estimated by a
two-stage instrumental variable analysis
with a logistic regression model.
Statistics in Medicine, 2013, 32, 27, 4726-4747.
doi: <a href='https://doi.org/10.1002/sim.5871'>10.1002/sim.5871</a></p>
<p>Clarke PS, Palmer TM, Windmeijer F. Estimating structural
mean models with multiple instrumental variables using the
Generalised Method of Moments. Statistical Science, 2015, 30, 1,
96-117. doi: <a href='https://doi.org/10.1214/14-STS503'>10.1214/14-STS503</a></p>
<p>Dukes O, Vansteelandt S.
A note on G-estimation of causal risk ratios.
American Journal of Epidemiology, 2018, 187, 5, 1079-1084.
doi: <a href='https://doi.org/10.1093/aje/kwx347'>10.1093/aje/kwx347</a></p>
<p>Palmer TM, Sterne JAC, Harbord RM, Lawlor DA, Sheehan NA, Meng S,
Granell R, Davey Smith G, Didelez V.
Instrumental variable estimation of causal risk ratios and causal odds ratios
in Mendelian randomization analyses.
American Journal of Epidemiology, 2011, 173, 12, 1392-1403.
doi: <a href='https://doi.org/10.1093/aje/kwr026'>10.1093/aje/kwr026</a></p>
<p>Terza JV, Basu A, Rathouz PJ. Two-stage residual inclusion estimation:
Addressing endogeneity in health econometric modeling.
Journal of Health Economics, 2008, 27, 3, 531-543.
doi: <a href='https://doi.org/10.1016/j.jhealeco.2007.09.009'>10.1016/j.jhealeco.2007.09.009</a></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Two-stage predictor substitution estimator</span>
<span class='co'># with second stage logistic regression</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>9</span><span class='op'>)</span>
<span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fl'>1000</span>
<span class='va'>psi0</span> <span class='op'>&lt;-</span> <span class='fl'>0.5</span>
<span class='va'>Z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Binomial.html'>rbinom</a></span><span class='op'>(</span><span class='va'>n</span>, <span class='fl'>1</span>, <span class='fl'>0.5</span><span class='op'>)</span>
<span class='va'>X</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Binomial.html'>rbinom</a></span><span class='op'>(</span><span class='va'>n</span>, <span class='fl'>1</span>, <span class='fl'>0.7</span><span class='op'>*</span><span class='va'>Z</span> <span class='op'>+</span> <span class='fl'>0.2</span><span class='op'>*</span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>-</span> <span class='va'>Z</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>m0</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='fl'>0.8</span><span class='op'>*</span><span class='va'>X</span> <span class='op'>-</span> <span class='fl'>0.39</span><span class='op'>*</span><span class='va'>Z</span><span class='op'>)</span>
<span class='va'>Y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Binomial.html'>rbinom</a></span><span class='op'>(</span><span class='va'>n</span>, <span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span><span class='va'>psi0</span><span class='op'>*</span><span class='va'>X</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>m0</span><span class='op'>/</span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>-</span> <span class='va'>m0</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>Z</span>, <span class='va'>X</span>, <span class='va'>Y</span><span class='op'>)</span>
<span class='va'>tspslogitfit</span> <span class='op'>&lt;-</span> <span class='fu'>tsps</span><span class='op'>(</span><span class='va'>Y</span> <span class='op'>~</span> <span class='va'>X</span> <span class='op'>|</span> <span class='va'>Z</span> , data <span class='op'>=</span> <span class='va'>dat</span>, link <span class='op'>=</span> <span class='st'>"logit"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>tspslogitfit</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt; GMM fit summary:
#&gt; 
#&gt; Call:
#&gt; gmm::gmm(g = tspsLogitMoments, x = dat, t0 = t0, vcov = "iid")
#&gt; 
#&gt; 
#&gt; Method:  twoStep 
#&gt; 
#&gt; Coefficients:
#&gt;               Estimate    Std. Error  t value     Pr(&gt;|t|)  
#&gt; Z(Intercept)  1.7647e-01  1.7169e-02  1.0278e+01  8.8297e-25
#&gt; ZZ            5.4740e-01  2.6249e-02  2.0854e+01  1.4138e-96
#&gt; (Intercept)   9.7133e-01  1.4042e-01  6.9173e+00  4.6027e-12
#&gt; xhat          6.1451e-01  2.7464e-01  2.2375e+00  2.5256e-02
#&gt; 
#&gt; J-Test: degrees of freedom is 0 
#&gt;                 J-test                P-value             
#&gt; Test E(g)=0:    8.88497490724335e-23  *******             
#&gt; 
#&gt; #############
#&gt; Information related to the numerical optimization
#&gt; Convergence code =  0 
#&gt; Function eval. =  169 
#&gt; Gradian eval. =  NA 
#&gt; 
#&gt; Estimates with 95% CI limits:
#&gt;              Estimate   0.025  0.975
#&gt; Z(Intercept)   0.1765 0.14282 0.2101
#&gt; ZZ             0.5474 0.49595 0.5988
#&gt; (Intercept)    0.9713 0.69611 1.2465
#&gt; xhat           0.6145 0.07622 1.1528
#&gt; </div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Tom Palmer, Wes Spiller, Eleanor Sanderson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


